<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="css/main.css">
    <link rel="icon" type="image/png" href="imgs/scrapfavicon.png">
    <script src="js/balance.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>
    <script src="js/realtime.js"></script>
    <title>ScrapHouse - Jackpot</title>
</head>
<body style="background-color: #282828;">
    <nav style="background-color: transparent; width: 100%; height: 100px;" class="flex justify-center items-center">
        <div style="width: 95%; height: 60px; background-color: #363636; border-radius: 7px;" class="flex flex-row">
            <ul class="nav-left flex items-center space-x-4" style="height: 100%; width: 33.33%; background-color: transparent;">
                <img src="imgs/ScrapHouseLogo.png" style="cursor: pointer;" class="logo" onclick="window.location.href = window.location.origin">
                <button onclick="window.location.href = 'verify.html'" style="background-color: #424242; color: #4ECCA3; padding: 8px 16px; border-radius: 6px; border: 2px solid #4ECCA3; cursor: pointer; font-family: sansation; font-weight: bold; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#4ECCA3'; this.style.color='white'" onmouseout="this.style.backgroundColor='#424242'; this.style.color='#4ECCA3'">
                    Provably Fair
                </button>
            </ul>
            <ul class="nav-middle flex justify-center items-center" style="width: 33.33%; height: 100%;">
                <div class="balance flex items-center justify-center relative" onclick="if (document.getElementById('depohud').classList.contains('hidden')) {document.getElementById('depohud').classList.remove('hidden')} else {document.getElementById('depohud').classList.add('hidden')}" style="cursor: pointer; height: 40px; background-color: #424242; min-width: 110px; width: auto; padding: 0 15px; border-radius: 10px;">
                    <span style="color: rgb(185, 185, 185); white-space: nowrap;">Balance: <span style="color: #4ECCA3;"><strong id="userBalance" class="balance-display">$0.00</strong></span></span>
                    
                    <div id="depohud" class="depohud absolute flex justify-center items-center hidden" style="border-radius: 10px; background-color: #424242; top: 50px; height: 40px; width: 100%;">
                        <div class="triangle-up absolute" style="top: -15px; width: 0; justify-content: 0; border-left: 7.5px solid transparent; border-right: 7.5px solid transparent; border-bottom: 15px solid #424242;"></div>
                        <div class="deposit" onclick="window.location.href = window.location.origin + '/deposit.html'" style="width: 90%; height: 70%; border-radius: 5px; text-align: center; color: white; text-shadow: 1px 3px 10px #111">Deposit</div>
                    </div>
                </div>
            </ul>
            <ul class="nav-right" style="width: 33.33%;">
                <div class="flex items-center justify-end space-x-2" style="width: 100%; height: 100%;">
                    <!-- User Profile Section -->
                    <div id="user-profile" class="hidden flex items-center space-x-2">
                        <img id="user-avatar" src="" style="height: 40px; width: 40px; border-radius: 50%;">
                        <span id="user-name" style="color: white; font-family: sansation;"></span>
                        <button onclick="logout()" style="background-color: #424242; color: #ff6b6b; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Logout</button>
                    </div>
                    <!-- Login Button -->
                    <button id="login-btn" onclick="window.location.href='/login'" style="background-color: #4ECCA3; color: white; padding: 8px 16px; border-radius: 6px; font-family: sansation; font-weight: bold;">
                        Login with Steam
                    </button>
                    <img id="chatToggle" class="nav-icons" src="imgs/message-dots.png" style="height: 40px; width: 40px;" onclick="toggleChat()">
                </div>
            </ul>
        </div>
    </nav>

    <!-- Chat Panel -->
    <div id="chatPanel" class="chat-panel">
        <div class="chat-header">
            <h3 style="font-family: carving; color: #4ECCA3; font-size: 20px; margin: 0;">Chat</h3>
            <button id="chatClose" onclick="toggleChat()" style="background: none; border: none; color: #b9b9b9; font-size: 18px; cursor: pointer;">×</button>
        </div>
        <div id="chatMessages" class="chat-messages thingything">
            <!-- Chat messages will be populated here -->
        </div>
        <div class="chat-input-container">
            <input 
                type="text" 
                id="chatInput" 
                placeholder="Type a message..." 
                maxlength="200"
                style="font-family: sansation; background-color: #424242; color: white; border: 1px solid #424242; border-radius: 6px; padding: 8px; width: 100%; outline: none;"
                onkeypress="handleChatKeyPress(event)"
            >
            <button 
                id="chatSend" 
                onclick="sendChatMessage()"
                style="font-family: sansation; background-color: #4ECCA3; color: white; border: none; border-radius: 6px; padding: 8px 12px; margin-left: 8px; cursor: pointer; transition: 500ms ease;"
                onmouseover="this.style.backgroundColor='#389676'"
                onmouseout="this.style.backgroundColor='#4ECCA3'"
            >
                Send
            </button>
        </div>
    </div>

    <!-- Main Content Container -->
    <div id="mainContent" class="main-content">
    <!-- Main Jackpot Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Game Info Section -->
        <div style="background-color: #1d1d1d; border-radius: 13px; border: 1px solid #424242;" class="p-6 mb-6">
            <div id="gameInfo" class="text-center">
                <h2 style="font-family: carving; color: #4ECCA3; font-size: 28px;" class="mb-2">Loading Game...</h2>
                <div style="font-family: iceberg; color: #4ECCA3; font-size: 48px;" class="font-bold mb-2">$0.00</div>
                <div style="font-family: sansation; color: #b9b9b9; font-size: 18px;">0 Players</div>
            </div>
        </div>

        <!-- Jackpot Spinner -->
        <div style="background-color: #1d1d1d; border-radius: 13px; border: 1px solid #424242;" class="p-6 mb-6">
            <h3 style="font-family: carving; color: #4ECCA3; font-size: 25px;" class="mb-4 text-center">Jackpot Wheel</h3>
            <div class="flex justify-center">
                <canvas id="jackpotSpinner" style="border-radius: 50%; box-shadow: 0 0 20px rgba(78, 204, 163, 0.3);"></canvas>
            </div>
        </div>

        <!-- Countdown Timer -->
        <div style="background-color: #1d1d1d; border-radius: 13px; border: 1px solid #424242;" class="p-6 mb-6 text-center">
            <h3 style="font-family: carving; color: #4ECCA3; font-size: 25px;" class="mb-4">Next Draw In:</h3>
            <div id="countdown" style="font-family: iceberg; color: #4ECCA3; font-size: 72px;" class="font-bold">60</div>
            <div style="font-family: sansation; color: #b9b9b9;" class="mt-2">seconds</div>
        </div>

        <!-- Winner Display (Hidden by default) -->
        <div id="winnerDisplay" class="mb-6 hidden"></div>

        <!-- Error Message Display -->
        <div id="authErrorMessage" class="mb-6 hidden" style="background-color: #2d1b1b; border: 1px solid #d32f2f; border-radius: 13px; padding: 16px;">
            <div class="flex items-center">
                <svg class="w-6 h-6 text-red-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                <div>
                    <h4 style="font-family: carving; color: #f44336; font-size: 18px;" class="font-bold">Authentication Required</h4>
                    <p id="authErrorText" style="font-family: sansation; color: #ffcdd2; font-size: 14px;" class="mt-1">You must be logged in to join games! Please login with Steam to continue.</p>
                </div>
            </div>
        </div>

        <!-- Steam Login Warning (Hidden by default, shown for non-authenticated users) -->
        <div id="steamLoginWarning" class="mb-6 hidden" style="background-color: #2d1b1b; border: 1px solid #d32f2f; border-radius: 13px; padding: 16px;">
            <div class="flex items-center">
                <svg class="w-6 h-6 text-red-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                <div>
                    <h4 style="font-family: carving; color: #f44336; font-size: 18px;" class="font-bold">Steam Login Required</h4>
                    <p style="font-family: sansation; color: #ffcdd2; font-size: 14px;" class="mt-1">You must log into Steam to join jackpot games. <a href="/login" style="color: #4ECCA3; text-decoration: underline;">Click here to login</a></p>
                </div>
            </div>
        </div>

        <!-- Players List -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div style="background-color: #1d1d1d; border-radius: 13px; border: 1px solid #424242;" class="p-6">
                <h3 style="font-family: carving; color: #4ECCA3; font-size: 25px;" class="mb-4">Current Players</h3>
                <div id="playersList" class="space-y-2 max-h-96 overflow-y-auto thingything">
                    <!-- Players will be populated by JavaScript -->
                </div>
            </div>

            <!-- Game History -->
            <div style="background-color: #1d1d1d; border-radius: 13px; border: 1px solid #424242;" class="p-6">
                <h3 style="font-family: carving; color: #4ECCA3; font-size: 25px;" class="mb-4">Recent Games</h3>
                <div id="gameHistory" class="space-y-1 max-h-96 overflow-y-auto thingything">
                    <!-- History will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Join Game Section -->
        <div style="background-color: #1d1d1d; border-radius: 13px; border: 1px solid #424242;" class="p-6 mb-6">
            <h3 style="font-family: carving; color: #4ECCA3; font-size: 25px;" class="mb-4">Join Jackpot</h3>
            <div class="flex items-end space-x-4">
                <div class="flex-1">
                    <label for="betAmount" style="font-family: sansation; color: #b9b9b9;" class="block text-sm mb-2">Bet Amount ($)</label>
                    <input 
                        type="number" 
                        id="betAmount" 
                        min="1" 
                        step="0.01" 
                        placeholder="Enter bet amount"
                        style="font-family: iceberg; background-color: #424242; color: white; border: 1px solid #424242; border-radius: 10px;"
                        class="w-full px-4 py-2 focus:outline-none"
                    >
                </div>
                <button 
                    id="joinGameBtn"
                    style="font-family: sansation; background-color: #4ECCA3; color: white; border-radius: 10px; transition: 500ms ease;"
                    class="px-6 py-2 font-semibold"
                    onmouseover="this.style.backgroundColor='#389676'"
                    onmouseout="this.style.backgroundColor='#4ECCA3'"
                >
                    Join Game
                </button>
            </div>
            <div style="font-family: sansation; color: #b9b9b9;" class="mt-3 text-sm">
                Your bet amount determines your win percentage.
            </div>
        </div>

        <!-- Game Rules -->
        <div style="background-color: #1d1d1d; border-radius: 13px; border: 1px solid #424242;" class="p-6 mt-6">
            <h3 style="font-family: carving; color: #4ECCA3; font-size: 25px;" class="mb-4">How It Works</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center">
                    <div class="text-3xl mb-2">💰</div>
                    <h4 style="font-family: sansation; color: white;" class="font-semibold mb-2">Place Your Bet</h4>
                    <p style="font-family: iceberg; color: #b9b9b9;" class="text-sm">Your bet amount determines your percentage chance to win. You can join multiple times to increase your odds.</p>
                </div>
                <div class="text-center" style="background-color: transparent;">
                    <div class="text-3xl mb-2">🎯</div>
                    <h4 style="font-family: sansation; color: white;" class="font-semibold mb-2">Provably Fair</h4>
                    <p style="font-family: iceberg; color: #b9b9b9;" class="text-sm">Every game uses cryptographic secrets to ensure fairness. <a href="verify.html" style="color: #4ECCA3;">Verify results here</a>.</p>
                </div>
                <div class="text-center">
                    <div class="text-3xl mb-2">🏆</div>
                    <h4 style="font-family: sansation; color: white;" class="font-semibold mb-2">Winner Takes All</h4>
                    <p style="font-family: iceberg; color: #b9b9b9;" class="text-sm">The winner is drawn every 60 seconds and takes the entire jackpot pot.</p>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Include Jackpot JavaScript -->
    <script src="js/auth.js?v=2"></script>
    <script src="js/spinner_new.js?v=2.0"></script>
    <script src="js/jackpot.js"></script>
    <script src="js/chat.js"></script>
</body>
</html>