<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="css/main.css">
    <link rel="icon" type="image/png" href="imgs/scrapfavicon.png">
    <script src="js/balance.js"></script>
    <title>Solana Deposit - ScrapHouse</title>
</head>
<body style="background-color: #282828;">
    <div id="DepositShade" onclick="window.location.href = 'deposit.html'" class="DepositShade absolute flex justify-center items-center" style="background-color: black; opacity: 0.6; width: 100%; height: 100%; z-index: 4;"></div>
    <div id="DepositPage" class="DepositPage absolute flex justify-center items-center" style="height: 100%; width: 100%;">
        <div style="overflow-y: auto; background-color: #282828; border-radius: 30px 0px 0px 30px; z-index: 5; width: 70%; height: 80%; border: 1px solid #424242;" class="flex items-center flex-col">
            
            <!-- Header -->
            <div class="flex items-center justify-between" style="width: 90%; margin-top: 20px;">
                <button onclick="window.location.href = 'deposit.html'" class="flex items-center" style="background: none; border: none; color: #4ECCA3; font-family: sansation; cursor: pointer;">
                    <span style="font-size: 20px; margin-right: 10px;">‚Üê</span> Back to Deposits
                </button>
                <div class="flex items-center">
                    <img src="imgs/DepositMethods/solana-sol-logo.png" style="width: 40px; height: 40px; margin-right: 10px;">
                    <span style="font-size: 28px; color: #4ECCA3; font-family: carving;">Solana (SOL)</span>
                </div>
            </div>

            <hr style="color: rgb(65, 65, 65); width: 90%; height: 2px; margin: 20px 0;">

            <!-- Deposit Form -->
            <div style="width: 90%; background-color: #1d1d1d; border-radius: 15px; padding: 30px;">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    
                    <!-- Left Column - Deposit Info -->
                    <div>
                        <h3 style="color: #4ECCA3; font-family: carving; font-size: 22px; margin-bottom: 20px;">Deposit Information</h3>
                        
                        <div style="background-color: #363636; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                            <div style="margin-bottom: 15px;">
                                <label style="color: #b9b9b9; font-family: sansation; font-size: 14px;">Deposit Address:</label>
                                <div class="flex items-center" style="margin-top: 5px;">
                                    <input type="text" id="solAddress" readonly value="4p8FCxXYAtymCJaQ1joa61KRTzLMwppv74zyJv2RP7Fb" 
                                           style="background-color: #282828; border: 1px solid #424242; border-radius: 8px; padding: 10px; color: white; font-family: monospace; font-size: 12px; flex: 1;">
                                    <button onclick="copyAddress()" style="background-color: #4ECCA3; color: white; border: none; border-radius: 8px; padding: 10px 15px; margin-left: 10px; cursor: pointer; font-family: sansation;">
                                        Copy
                                    </button>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="color: #b9b9b9; font-family: sansation; font-size: 14px;">Network:</label>
                                <div style="color: white; font-family: sansation; margin-top: 5px;">Solana Mainnet</div>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="color: #b9b9b9; font-family: sansation; font-size: 14px;">Minimum Deposit:</label>
                                <div style="color: #4ECCA3; font-family: sansation; margin-top: 5px; font-weight: bold;">$5.00 USD</div>
                            </div>
                            
                            <div>
                                <label style="color: #b9b9b9; font-family: sansation; font-size: 14px;">Confirmations Required:</label>
                                <div style="color: white; font-family: sansation; margin-top: 5px;">1 confirmation</div>
                            </div>
                        </div>

                        <!-- Deposit Calculator -->
                        <div style="background-color: #424242; border-radius: 10px; padding: 15px; border-left: 4px solid #4ECCA3; margin-bottom: 15px;">
                            <h4 style="color: #4ECCA3; font-family: sansation; font-size: 16px; margin-bottom: 15px;">üí∞ Deposit Calculator (25% BONUS!)</h4>
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <input type="number" id="solAmount" placeholder="0.1" step="0.00000001" min="0" 
                                       style="background-color: #363636; border: 1px solid #555; border-radius: 6px; padding: 8px; color: white; font-family: sansation; flex: 1;">
                                <span style="color: white; font-family: sansation; display: flex; align-items: center; padding: 0 10px;">SOL</span>
                            </div>
                            <button onclick="calculateSOLDeposit()" style="background-color: #4ECCA3; color: white; border: none; border-radius: 6px; padding: 10px 20px; cursor: pointer; font-family: sansation; width: 100%;">
                                Calculate Deposit + Bonus
                            </button>
                            <div id="solCalculationResult" style="margin-top: 15px; display: none;">
                                <div style="background-color: #363636; border-radius: 6px; padding: 10px;">
                                    <p style="color: #b9b9b9; font-family: sansation; margin: 5px 0;">USD Value: <span id="solUsdValue" style="color: white;"></span></p>
                                    <p style="color: #b9b9b9; font-family: sansation; margin: 5px 0;">25% Bonus: <span id="solBonusAmount" style="color: #4ECCA3;"></span></p>
                                    <p style="color: #b9b9b9; font-family: sansation; margin: 5px 0; border-top: 1px solid #555; padding-top: 5px;"><strong>Total Credit: <span id="solTotalCredit" style="color: #4ECCA3;"></span></strong></p>
                                </div>
                            </div>
                        </div>

                        <!-- Important Notes -->
                        <div style="background-color: #424242; border-radius: 10px; padding: 15px; border-left: 4px solid #ff6b6b;">
                            <h4 style="color: #ff6b6b; font-family: sansation; font-size: 16px; margin-bottom: 10px;">‚ö†Ô∏è Important Notes</h4>
                            <ul style="color: #b9b9b9; font-family: sansation; font-size: 13px; line-height: 1.5;">
                                <li>‚Ä¢ Only send Solana (SOL) to this address</li>
                                <li>‚Ä¢ Use Solana mainnet only</li>
                                <li>‚Ä¢ Minimum deposit: $5.00 USD</li>
                                <li>‚Ä¢ 25% bonus applied to all deposits!</li>
                                <li>‚Ä¢ Very fast confirmation times</li>
                                <li>‚Ä¢ Low transaction fees</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Right Column - QR Code & Status -->
                    <div class="flex flex-col items-center">
                        <h3 style="color: #4ECCA3; font-family: carving; font-size: 22px; margin-bottom: 20px;">QR Code</h3>
                        
                        <div style="background-color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                            <img src="imgs/DepositMethods/qr/solpng.png" alt="Solana QR Code" style="width: 200px; height: 200px; border-radius: 10px;">
                        </div>

                        <!-- User Address Input -->
                        <div style="width: 100%; background-color: #363636; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                            <h4 style="color: #4ECCA3; font-family: sansation; font-size: 16px; margin-bottom: 15px;">Your Sending Address</h4>
                            <div style="margin-bottom: 10px;">
                                <input type="text" id="userSolAddress" placeholder="Enter your Solana address (for tracking)" 
                                       style="background-color: #282828; border: 1px solid #424242; border-radius: 8px; padding: 10px; color: white; font-family: monospace; font-size: 12px; width: 100%;">
                            </div>
                            <button onclick="saveUserAddress('SOL')" style="background-color: #4ECCA3; color: white; border: none; border-radius: 6px; padding: 8px 16px; cursor: pointer; font-family: sansation; width: 100%;">
                                Save & Start Monitoring
                            </button>
                        </div>

                        <!-- Deposit Status -->
                        <div style="width: 100%; background-color: #363636; border-radius: 10px; padding: 20px;">
                            <h4 style="color: #4ECCA3; font-family: sansation; font-size: 16px; margin-bottom: 15px;">Deposit Status</h4>
                            <div id="depositStatus" style="color: #b9b9b9; font-family: sansation; text-align: center; padding: 20px;">
                                Enter your address to start monitoring...
                            </div>
                            
                            <div style="margin-top: 15px;">
                                <div style="color: #b9b9b9; font-family: sansation; font-size: 14px; margin-bottom: 5px;">Network Status:</div>
                                <div id="networkStatus" style="background-color: #282828; border-radius: 8px; padding: 10px; font-family: sansation; font-size: 12px; color: #4CAF50;">
                                    ‚úÖ Network Healthy - Fast Transactions
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav style="background-color: transparent; width: 100%; height: 100px;" class="flex justify-center items-center">
        <div style="width: 95%; height: 60px; background-color: #363636; border-radius: 7px;" class="flex flex-row">
            <ul class="nav-left flex items-center" style="height: 100%; width: 33%;">
                <img src="imgs/ScrapHouseLogo.png" style="cursor: pointer;" class="logo" onclick="window.location.href = window.location.origin">
            </ul>
            <ul class="nav-middle flex justify-center items-center" style="width: 33%; height: 100%;">
                <div class="balance flex items-center justify-center relative" style="cursor: pointer; height: 75%; background-color: #424242; min-width: 110px; width: auto; padding: 0 15px; border-radius: 10px;">
                    <span style="color: rgb(185, 185, 185); white-space: nowrap;">Balance: <span style="color: #4ECCA3;"><strong class="balance-display">$0.00</strong></span></span>
                </div>
            </ul>
            <ul class="nav-right" style="width: 33%;">
                <div class="flex items-center" style="width: 100%; height: 100%; flex-direction: row-reverse;">
                    <img src="imgs/user-circle.png" style="height: 40px; width: 40px;">
                    <img src="imgs/message-dots.png" style="height: 40px; width: 40px;">
                </div>
            </ul>
        </div>
    </nav>

    <script>
        function copyAddress() {
            const address = document.getElementById('solAddress').value;
            navigator.clipboard.writeText(address).then(() => {
                // Show success feedback
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.style.backgroundColor = '#4CAF50';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = '#4ECCA3';
                }, 2000);
            });
        }

        async function calculateSOLDeposit() {
            const solAmount = document.getElementById('solAmount').value;
            const resultDiv = document.getElementById('solCalculationResult');
            
            if (!solAmount || solAmount <= 0) {
                alert('Please enter a valid SOL amount');
                return;
            }

            try {
                const response = await fetch('/calculateDeposit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        cryptoAmount: solAmount,
                        cryptoSymbol: 'SOL'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('solUsdValue').textContent = '$' + data.usdValue;
                    document.getElementById('solBonusAmount').textContent = '$' + data.bonusAmount;
                    document.getElementById('solTotalCredit').textContent = '$' + data.totalCredit;
                    resultDiv.style.display = 'block';
                } else {
                    alert(data.message);
                    resultDiv.style.display = 'none';
                }
            } catch (error) {
                console.error('Error calculating deposit:', error);
                alert('Error calculating deposit. Please try again.');
            }
        }

        function saveUserAddress(crypto) {
            const addressInput = document.getElementById('userSolAddress');
            const userAddress = addressInput.value.trim();
            
            if (!userAddress) {
                alert('Please enter your Solana address');
                return;
            }

            try {
                // Save to localStorage
                const depositAddresses = JSON.parse(localStorage.getItem('depositAddresses') || '{}');
                depositAddresses[crypto] = userAddress;
                localStorage.setItem('depositAddresses', JSON.stringify(depositAddresses));
                
                // Save timestamp for tracking
                localStorage.setItem(`${crypto}_monitoring_start`, Date.now().toString());

                document.getElementById('depositStatus').innerHTML = `
                    <div style="color: #4ECCA3;">‚úÖ Monitoring Started</div>
                    <div style="font-size: 12px; margin-top: 10px;">Watching for deposits from:<br>
                    <span style="font-family: monospace; word-break: break-all;">${userAddress}</span></div>
                `;
                startDepositMonitoring(userAddress, crypto);
            } catch (error) {
                console.error('Error saving address:', error);
                alert('Error saving address. Please try again.');
            }
        }

        function startDepositMonitoring(userAddress, crypto) {
            // Poll for deposits every 30 seconds
            const monitoringInterval = setInterval(() => {
                try {
                    // Simulate deposit detection (10% chance for demo)
                    const simulateDeposit = Math.random() < 0.1;
                    
                    if (simulateDeposit) {
                        // Simulate a deposit
                        const cryptoPrices = {
                            'BTC': 45000,
                            'ETH': 2500,
                            'SOL': 100
                        };
                        
                        const depositAmount = crypto === 'BTC' ? 0.001 : 
                                              crypto === 'ETH' ? 0.01 : 0.1;
                        
                        const usdValue = depositAmount * cryptoPrices[crypto];
                        const bonus = usdValue * 0.25; // 25% bonus
                        const totalCredit = usdValue + bonus;
                        
                        // Update balance in localStorage
                        const currentBalance = parseFloat(localStorage.getItem('userBalance') || '0');
                        const newBalance = currentBalance + totalCredit;
                        localStorage.setItem('userBalance', newBalance.toString());
                        
                        // Record deposit in localStorage
                        const deposits = JSON.parse(localStorage.getItem('depositHistory') || '[]');
                        deposits.push({
                            cryptoType: crypto,
                            amount: depositAmount,
                            usdValue: usdValue.toFixed(2),
                            bonus: bonus.toFixed(2),
                            totalCredit: totalCredit.toFixed(2),
                            timestamp: new Date().toISOString(),
                            fromAddress: userAddress
                        });
                        localStorage.setItem('depositHistory', JSON.stringify(deposits));
                        
                        // Update status with new deposits
                        const statusDiv = document.getElementById('depositStatus');
                        statusDiv.innerHTML = `
                            <div style="color: #4CAF50;">üéâ Deposit Detected!</div>
                            <div style="font-size: 12px; margin-top: 10px;">
                                Amount: ${depositAmount} ${crypto}<br>
                                Value: $${usdValue.toFixed(2)}<br>
                                Bonus: $${bonus.toFixed(2)}<br>
                                <strong>Total Credit: $${totalCredit.toFixed(2)}</strong>
                            </div>
                        `;
                        
                        // Update balance display
                        const balanceElements = document.querySelectorAll('.balance-display');
                        balanceElements.forEach(el => {
                            el.textContent = '$' + newBalance.toFixed(2);
                        });
                        
                        // Clear interval after successful deposit
                        clearInterval(monitoringInterval);
                        
                        console.log(`Deposit detected: ${depositAmount} ${crypto} = $${totalCredit.toFixed(2)}`);
                    }
                } catch (error) {
                    console.error('Error checking deposits:', error);
                }
            }, 30000);
        }
    </script>
</body>
</html>
