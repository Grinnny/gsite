<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="css/main.css">
    <link rel="icon" type="image/png" href="imgs/scrapfavicon.png">
    <script src="js/balance.js"></script>
    <title>Rust Skins Deposit - ScrapHouse</title>
</head>
<body style="background-color: #282828;">
    <div id="DepositShade" onclick="window.location.href = 'deposit.html'" class="DepositShade absolute flex justify-center items-center" style="background-color: black; opacity: 0.6; width: 100%; height: 100%; z-index: 4;"></div>
    <div id="DepositPage" class="DepositPage absolute flex justify-center items-center" style="height: 100%; width: 100%;">
        <div style="overflow-y: auto; background-color: #282828; border-radius: 30px 0px 0px 30px; z-index: 5; width: 70%; height: 80%; border: 1px solid #424242;" class="flex items-center flex-col">
            
            <!-- Header -->
            <div class="flex items-center justify-between" style="width: 90%; margin-top: 20px;">
                <button onclick="window.location.href = 'deposit.html'" class="flex items-center" style="background: none; border: none; color: #4ECCA3; font-family: sansation; cursor: pointer;">
                    <span style="font-size: 20px; margin-right: 10px;">←</span> Back to Deposits
                </button>
                <div class="flex items-center">
                    <img src="imgs/DepositMethods/rust.png" style="width: 40px; height: 40px; margin-right: 10px;">
                    <span style="font-size: 28px; color: #4ECCA3; font-family: carving;">Rust Skins</span>
                </div>
            </div>

            <hr style="color: rgb(65, 65, 65); width: 90%; height: 2px; margin: 20px 0;">

            <!-- Deposit Form -->
            <div style="width: 90%; background-color: #1d1d1d; border-radius: 15px; padding: 30px;">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    
                    <!-- Left Column - Deposit Info -->
                    <div>
                        <h3 style="color: #4ECCA3; font-family: carving; font-size: 22px; margin-bottom: 20px;">Steam Trade Information</h3>
                        
                        <div style="background-color: #363636; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                            <div style="margin-bottom: 15px;">
                                <label style="color: #b9b9b9; font-family: sansation; font-size: 14px;">Trade URL:</label>
                                <div class="flex items-center" style="margin-top: 5px;">
                                    <input type="text" id="tradeUrl" placeholder="Paste your Steam trade URL here..." 
                                           style="background-color: #282828; border: 1px solid #424242; border-radius: 8px; padding: 10px; color: white; font-family: sansation; font-size: 12px; flex: 1;">
                                    <button onclick="saveTradeUrl()" style="background-color: #4ECCA3; color: white; border: none; border-radius: 8px; padding: 10px 15px; margin-left: 10px; cursor: pointer; font-family: sansation;">
                                        Save
                                    </button>
                                </div>
                                <div style="color: #666; font-family: sansation; font-size: 11px; margin-top: 5px;">Required to scan your Rust inventory and send trade offers</div>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="color: #b9b9b9; font-family: sansation; font-size: 14px;">Game:</label>
                                <div style="color: white; font-family: sansation; margin-top: 5px;">Rust</div>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="color: #b9b9b9; font-family: sansation; font-size: 14px;">Minimum Value:</label>
                                <div style="color: #4ECCA3; font-family: sansation; margin-top: 5px; font-weight: bold;">$5.00</div>
                            </div>
                            
                            <div>
                                <label style="color: #b9b9b9; font-family: sansation; font-size: 14px;">Processing Time:</label>
                                <div style="color: white; font-family: sansation; margin-top: 5px;">1-5 minutes</div>
                            </div>
                        </div>

                        <!-- Important Notes -->
                        <div style="background-color: #424242; border-radius: 10px; padding: 15px; border-left: 4px solid #ff6b6b;">
                            <h4 style="color: #ff6b6b; font-family: sansation; font-size: 16px; margin-bottom: 10px;">⚠️ Important Notes</h4>
                            <ul style="color: #b9b9b9; font-family: sansation; font-size: 13px; line-height: 1.5;">
                                <li>• Steam inventory must be public</li>
                                <li>• No trade holds or restrictions</li>
                                <li>• Minimum skin value: $5.00</li>
                                <li>• We accept all tradeable Rust skins</li>
                                <li>• Instant credit after trade completion</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Right Column - Inventory & Selection -->
                    <div class="flex flex-col items-center">
                        <h3 style="color: #4ECCA3; font-family: carving; font-size: 22px; margin-bottom: 20px;">Your Rust Inventory</h3>
                        
                        <div style="background-color: #363636; border-radius: 15px; padding: 20px; margin-bottom: 20px; width: 100%;">
                            <button onclick="scanInventory()" id="scanBtn" style="width: 100%; background-color: #4ECCA3; color: white; border: none; border-radius: 8px; padding: 12px; font-family: sansation; cursor: pointer; margin-bottom: 15px;">
                                Scan Rust Inventory
                            </button>
                            
                            <div id="inventoryItems" style="max-height: 300px; overflow-y: auto; display: none;">
                                <!-- Inventory items will be loaded here -->
                            </div>
                            
                            <div id="selectedItems" style="background-color: #282828; border-radius: 8px; padding: 15px; margin-top: 15px; display: none;">
                                <h5 style="color: #4ECCA3; font-family: sansation; font-size: 14px; margin-bottom: 10px;">Selected Items:</h5>
                                <div id="selectedList" style="color: #b9b9b9; font-family: sansation; font-size: 12px; margin-bottom: 10px;">No items selected</div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <span style="color: #b9b9b9; font-family: sansation; font-size: 12px;">Total Value:</span>
                                    <span id="totalValue" style="color: #4ECCA3; font-family: sansation; font-size: 14px; font-weight: bold;">$0.00</span>
                                </div>
                                <button onclick="sendTradeOffer()" id="tradeBtn" disabled style="width: 100%; background-color: #666; color: white; border: none; border-radius: 8px; padding: 10px; font-family: sansation; cursor: not-allowed;">
                                    Select Items to Trade
                                </button>
                            </div>
                        </div>

                        <!-- Deposit Status -->
                        <div style="width: 100%; background-color: #363636; border-radius: 10px; padding: 20px;">
                            <h4 style="color: #4ECCA3; font-family: sansation; font-size: 16px; margin-bottom: 15px;">Recent Deposits</h4>
                            <div id="recentDeposits" style="max-height: 200px; overflow-y: auto;">
                                <div style="color: #666; font-family: sansation; font-size: 12px; text-align: center; padding: 20px;">
                                    No recent deposits
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav style="background-color: transparent; width: 100%; height: 100px;" class="flex justify-center items-center">
        <div style="width: 95%; height: 60px; background-color: #363636; border-radius: 7px;" class="flex flex-row">
            <ul class="nav-left flex items-center" style="height: 100%; width: 33%;">
                <img src="imgs/ScrapHouseLogo.png" style="cursor: pointer;" class="logo" onclick="window.location.href = window.location.origin">
            </ul>
            <ul class="nav-middle flex justify-center items-center" style="width: 33%; height: 100%;">
                <div class="balance flex items-center justify-center relative" style="cursor: pointer; height: 75%; background-color: #424242; min-width: 110px; width: auto; padding: 0 15px; border-radius: 10px;">
                    <span style="color: rgb(185, 185, 185); white-space: nowrap;">Balance: <span style="color: #4ECCA3;"><strong class="balance-display">$0.00</strong></span></span>
                </div>
            </ul>
            <ul class="nav-right" style="width: 33%;">
                <div class="flex items-center" style="width: 100%; height: 100%; flex-direction: row-reverse;">
                    <img src="imgs/user-circle.png" style="height: 40px; width: 40px;">
                    <img src="imgs/message-dots.png" style="height: 40px; width: 40px;">
                </div>
            </ul>
        </div>
    </nav>

    <script>
        let skinportData = [];
        let selectedItems = [];
        let userInventory = [];

        // Load skinport price data
        async function loadSkinportData() {
            try {
                const response = await fetch('json/skinportdata.json');
                skinportData = await response.json();
                console.log('Loaded', skinportData.length, 'Rust skin prices');
            } catch (error) {
                console.error('Error loading skinport data:', error);
            }
        }

        function saveTradeUrl() {
            const tradeUrl = document.getElementById('tradeUrl').value;
            if (!tradeUrl || !tradeUrl.includes('steamcommunity.com/tradeoffer/new/')) {
                alert('Please enter a valid Steam trade URL');
                return;
            }
            
            localStorage.setItem('steamTradeUrl', tradeUrl);
            
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Saved!';
            button.style.backgroundColor = '#4CAF50';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.backgroundColor = '#4ECCA3';
            }, 2000);
        }

        function scanInventory() {
            const scanBtn = document.getElementById('scanBtn');
            scanBtn.textContent = 'Scanning...';
            scanBtn.disabled = true;
            
            // Simulate inventory scanning with sample Rust items
            setTimeout(() => {
                userInventory = [
                    { name: "AK-47 | Redline", market_hash_name: "AK-47 | Redline", icon_url: "https://community.cloudflare.steamstatic.com/economy/image/fWFc82js0fmoRAP-qOIPu5THSWqfSmTELLqcUywGkijVjZULUrsm1j-9xgEObwgfEh_nvjlWhNzZCveCDfIBj98xqodQ2CZknz56P7fiDzZ2TQXJVfdhX_Dsx1-5UGki5sAij6tOtQ/96fx96f" },
                    { name: "MP5 | Acid Wash", market_hash_name: "MP5 | Acid Wash", icon_url: "https://community.cloudflare.steamstatic.com/economy/image/fWFc82js0fmoRAP-qOIPu5THSWqfSmTELLqcUywGkijVjZULUrsm1j-9xgEObwgfEh_nvjlWhNzZCveCDfIBj98xqodQ2CZknz5uJ_OKIz5rdwrBBLJhWvws8Qm5UWcz5sAij6tOtQ/96fx96f" },
                    { name: "Hoodie | Tempered", market_hash_name: "Hoodie | Tempered", icon_url: "https://community.cloudflare.steamstatic.com/economy/image/fWFc82js0fmoRAP-qOIPu5THSWqfSmTELLqcUywGkijVjZULUrsm1j-9xgEObwgfEh_nvjlWhNzZCveCDfIBj98xqodQ2CZknz5uJ_OKIz5rdwrBBLJhWvws8Qm5UWcz5sAij6tOtQ/96fx96f" },
                    { name: "Pants | Tempered", market_hash_name: "Pants | Tempered", icon_url: "https://community.cloudflare.steamstatic.com/economy/image/fWFc82js0fmoRAP-qOIPu5THSWqfSmTELLqcUywGkijVjZULUrsm1j-9xgEObwgfEh_nvjlWhNzZCveCDfIBj98xqodQ2CZknz5uJ_OKIz5rdwrBBLJhWvws8Qm5UWcz5sAij6tOtQ/96fx96f" },
                    { name: "Gloves | Tempered", market_hash_name: "Gloves | Tempered", icon_url: "https://community.cloudflare.steamstatic.com/economy/image/fWFc82js0fmoRAP-qOIPu5THSWqfSmTELLqcUywGkijVjZULUrsm1j-9xgEObwgfEh_nvjlWhNzZCveCDfIBj98xqodQ2CZknz5uJ_OKIz5rdwrBBLJhWvws8Qm5UWcz5sAij6tOtQ/96fx96f" },
                    { name: "Boots | Tempered", market_hash_name: "Boots | Tempered", icon_url: "https://community.cloudflare.steamstatic.com/economy/image/fWFc82js0fmoRAP-qOIPu5THSWqfSmTELLqcUywGkijVjZULUrsm1j-9xgEObwgfEh_nvjlWhNzZCveCDfIBj98xqodQ2CZknz5uJ_OKIz5rdwrBBLJhWvws8Qm5UWcz5sAij6tOtQ/96fx96f" }
                ];
                
                displayInventory();
                scanBtn.textContent = 'Rescan Inventory';
                scanBtn.disabled = false;
            }, 2000);
        }

        function displayInventory() {
            const inventoryDiv = document.getElementById('inventoryItems');
            const selectedDiv = document.getElementById('selectedItems');
            
            inventoryDiv.innerHTML = '';
            inventoryDiv.style.display = 'block';
            selectedDiv.style.display = 'block';
            
            userInventory.forEach((item, index) => {
                const priceData = skinportData.find(skin => skin.market_hash_name === item.market_hash_name);
                const price = priceData ? priceData.suggested_price : 0;
                
                const itemDiv = document.createElement('div');
                itemDiv.style.cssText = `
                    display: flex; align-items: center; padding: 10px; margin-bottom: 8px;
                    background-color: #282828; border-radius: 8px; cursor: pointer;
                    border: 2px solid transparent; transition: all 0.2s;
                `;
                
                itemDiv.innerHTML = `
                    <div style="width: 50px; height: 50px; background-color: #424242; border-radius: 6px; margin-right: 10px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: #666; font-size: 10px;">IMG</span>
                    </div>
                    <div style="flex: 1;">
                        <div style="color: white; font-family: sansation; font-size: 12px; margin-bottom: 2px;">${item.name}</div>
                        <div style="color: #4ECCA3; font-family: sansation; font-size: 11px; font-weight: bold;">$${price.toFixed(2)}</div>
                    </div>
                    <input type="checkbox" onchange="toggleItemSelection(${index})" style="margin-left: 10px;">
                `;
                
                inventoryDiv.appendChild(itemDiv);
            });
        }

        function toggleItemSelection(index) {
            const item = userInventory[index];
            const priceData = skinportData.find(skin => skin.market_hash_name === item.market_hash_name);
            const price = priceData ? priceData.suggested_price : 0;
            
            const itemWithPrice = { ...item, price: price };
            
            const existingIndex = selectedItems.findIndex(selected => selected.name === item.name);
            
            if (existingIndex > -1) {
                selectedItems.splice(existingIndex, 1);
            } else {
                selectedItems.push(itemWithPrice);
            }
            
            updateSelectedDisplay();
        }

        function updateSelectedDisplay() {
            const selectedList = document.getElementById('selectedList');
            const totalValue = document.getElementById('totalValue');
            const tradeBtn = document.getElementById('tradeBtn');
            
            if (selectedItems.length === 0) {
                selectedList.textContent = 'No items selected';
                totalValue.textContent = '$0.00';
                tradeBtn.disabled = true;
                tradeBtn.style.backgroundColor = '#666';
                tradeBtn.style.cursor = 'not-allowed';
                tradeBtn.textContent = 'Select Items to Trade';
            } else {
                const total = selectedItems.reduce((sum, item) => sum + item.price, 0);
                
                selectedList.innerHTML = selectedItems.map(item => 
                    `<div style="margin-bottom: 2px;">${item.name} - $${item.price.toFixed(2)}</div>`
                ).join('');
                
                totalValue.textContent = '$' + total.toFixed(2);
                
                if (total >= 5) {
                    tradeBtn.disabled = false;
                    tradeBtn.style.backgroundColor = '#4ECCA3';
                    tradeBtn.style.cursor = 'pointer';
                    tradeBtn.textContent = `Trade ${selectedItems.length} Items ($${total.toFixed(2)})`;
                } else {
                    tradeBtn.disabled = true;
                    tradeBtn.style.backgroundColor = '#ff6b6b';
                    tradeBtn.style.cursor = 'not-allowed';
                    tradeBtn.textContent = `Minimum $5.00 required (Current: $${total.toFixed(2)})`;
                }
            }
        }

        function sendTradeOffer() {
            const tradeUrl = localStorage.getItem('steamTradeUrl');
            if (!tradeUrl) {
                alert('Please save your trade URL first');
                return;
            }
            
            if (selectedItems.length === 0) {
                alert('Please select items to trade');
                return;
            }
            
            const totalValue = selectedItems.reduce((sum, item) => sum + item.price, 0);
            
            if (totalValue < 5) {
                alert('Minimum trade value is $5.00');
                return;
            }
            
            // Simulate trade offer process
            const tradeBtn = document.getElementById('tradeBtn');
            tradeBtn.textContent = 'Sending Trade Offer...';
            tradeBtn.disabled = true;
            
            setTimeout(() => {
                // Simulate trade acceptance and balance update
                const currentBalance = parseFloat(localStorage.getItem('userBalance') || '0');
                const newBalance = currentBalance + totalValue;
                localStorage.setItem('userBalance', newBalance.toString());
                
                // Update balance display
                const balanceElements = document.querySelectorAll('.balance-display');
                balanceElements.forEach(el => {
                    el.textContent = '$' + newBalance.toFixed(2);
                });
                
                // Record deposit
                const deposits = JSON.parse(localStorage.getItem('depositHistory') || '[]');
                deposits.push({
                    type: 'rust_skins',
                    items: selectedItems,
                    totalValue: totalValue.toFixed(2),
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('depositHistory', JSON.stringify(deposits));
                
                // Update recent deposits display
                updateRecentDeposits();
                
                alert(`Trade completed successfully!\n\nItems traded: ${selectedItems.length}\nValue: $${totalValue.toFixed(2)}\nNew balance: $${newBalance.toFixed(2)}`);
                
                // Reset selection
                selectedItems = [];
                const checkboxes = document.querySelectorAll('#inventoryItems input[type="checkbox"]');
                checkboxes.forEach(cb => cb.checked = false);
                updateSelectedDisplay();
                
                tradeBtn.textContent = 'Select Items to Trade';
            }, 3000);
        }

        function updateRecentDeposits() {
            const recentDeposits = document.getElementById('recentDeposits');
            const deposits = JSON.parse(localStorage.getItem('depositHistory') || '[]');
            const rustDeposits = deposits.filter(d => d.type === 'rust_skins').slice(-3);
            
            if (rustDeposits.length === 0) {
                recentDeposits.innerHTML = '<div style="color: #666; font-family: sansation; font-size: 12px; text-align: center; padding: 20px;">No recent deposits</div>';
            } else {
                recentDeposits.innerHTML = rustDeposits.map(deposit => `
                    <div style="background-color: #282828; border-radius: 6px; padding: 10px; margin-bottom: 8px;">
                        <div style="color: #4ECCA3; font-family: sansation; font-size: 12px; font-weight: bold;">$${deposit.totalValue}</div>
                        <div style="color: #b9b9b9; font-family: sansation; font-size: 10px;">${deposit.items.length} items • ${new Date(deposit.timestamp).toLocaleString()}</div>
                    </div>
                `).join('');
            }
        }

        // Load saved trade URL and initialize
        window.addEventListener('load', async () => {
            await loadSkinportData();
            updateRecentDeposits();
            
            const savedUrl = localStorage.getItem('steamTradeUrl');
            if (savedUrl) {
                document.getElementById('tradeUrl').value = savedUrl;
            }
            
            // Load balance
            const balance = parseFloat(localStorage.getItem('userBalance') || '0');
            const balanceElements = document.querySelectorAll('.balance-display');
            balanceElements.forEach(el => {
                el.textContent = '$' + balance.toFixed(2);
            });
        });
    </script>
</body>
</html>
